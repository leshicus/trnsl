/* для пользователей */var gUsers=Ext.create('Ext.grid.Panel',{	columns:	[		{text:'ФИО',dataIndex:'name',flex:2},		{text:'Email',dataIndex:'email',flex:1},		{text:'Телефон',dataIndex:'phone',flex:1}	],	height:window.innerHeight-125,	width:window.innerWidth/1.5,	margin:10,	rbar:	[	]});/* для видов деятельности */var gActivity=Ext.create('Ext.grid.Panel',{	store:sActivity,	columnLines:true,	selType:'rowmodel',	listeners:	{		select:function(sm,selectedRecord)		{			Ext.getCmp('bActivity').setDisabled(false);		}	},	plugins: 	[		Ext.create('Ext.grid.plugin.RowEditing', 		{			clicksToEdit:2,			clicksToMoveEditor:1		})	],	columns:	[		{xtype:'rownumberer',text:'№',width:30},		{text:'Название',dataIndex:'ACTIVITY_NAME',editor:{xtype:'textfield'},flex:2},		{text:'Сокращение',dataIndex:'ACTIVITY_ABBR',editor:'textfield',flex:1}	],	height:window.innerHeight-125,	width:window.innerWidth-41,	margin:10,	rbar:	[		{			xtype:'button',			tooltip:'Добавить направление',			scale:'large',			icon:'img/add.ico',			handler:function(btn)			{				var editor=gActivity.getPlugin();				editor.cancelEdit();				gActivity.store.insert(0,{ACTIVITY_ID:gActivity.store.getCount()+1,ACTIVITY_NAME:'',ACTIVITY_ABBR:''});				editor.startEdit(0,0);			}		},		{			xtype:'button',			tooltip:'Удалить направление',			scale:'large',			icon:'img/cut.ico',			id:'bActivity',			disabled:true,			handler:function(btn)			{				var editor=gActivity.getPlugin();				editor.cancelEdit();				Ext.Msg.show(				{					title:'Удалить',					msg:'Вы уверены?',					buttons:Ext.Msg.YESNO,					icon:Ext.Msg.QUESTION,					fn:delete_activity				});				function delete_activity(buttonId)				{					var rows=gActivity.getView().getSelectionModel().getSelection()[0];					if(rows)					{						gActivity.store.remove(rows);						btn.setDisabled(true);					}					else						Ext.Msg.alert('Предупреждение','Произошла ошибка!Попробуйте снова.');				}			}		}	]});var arr=new Array();for(var i=0;i<10;i++){	var obj=new Object();	obj.text=i;	arr.push(obj);}//console.log(arr);var column=Ext.grid.column.Column(arr);/*var gSubject=Ext.create('Ext.grid.Panel',{	columns:arr,	height:window.innerHeight/2,	width:window.innerWidth/1.5,	margin:10});*///console.log(column);/* для областей знаний */var gSubject=Ext.create('Ext.grid.Panel',{	store:sSubject,	columnLines:true,	autoScroll:true,	selType:'cellmodel',	listeners:	{		select:function(sm,selectedRecord)		{			Ext.getCmp('bSubject').setDisabled(false);		}	},	plugins: 	[		Ext.create('Ext.grid.plugin.CellEditing', 		{			clicksToEdit:2		})	],	columns:	[		{xtype:'rownumberer',text:'№',width:30},		{text:'Название',dataIndex:'SUBJECT_NAME',editor:{xtype:'textfield'},flex:1}	],	height:window.innerHeight/3,	width:window.innerWidth/1.5,	margin:10,	rbar:	[		{			xtype:'button',			tooltip:'Добавить предмет',			scale:'large',			icon:'img/add.ico',			handler:function(btn)			{				var editor=gSubject.getPlugin();				editor.cancelEdit();				gSubject.store.insert(0,{SUBJECT_ID:gSubject.store.getCount()+100,SUBJECT_NAME:'Новый предмет'});				/*editor.startEditByPosition({					row:0,					column:1				});*/			}		},		{			xtype:'button',			tooltip:'Удалить предмет',			scale:'large',			icon:'img/cut.ico',			id:'bSubject',			disabled:true,			handler:function(btn)			{				var editor=gSubject.getPlugin();				editor.cancelEdit();				Ext.Msg.show(				{					title:'Удалить',					msg:'Вы уверены?',					buttons:Ext.Msg.YESNO,					icon:Ext.Msg.QUESTION,					fn:delete_subject				});				function delete_subject(buttonId)				{					var rows=gSubject.getView().getSelectionModel().getSelection()[0];					if(rows)					{						gSubject.store.remove(rows);						gDistribution.store.load();						btn.setDisabled(true);					}					else						Ext.Msg.alert('Предупреждение','Произошла ошибка!Попробуйте снова.');				}			}		}	]});/* для распределения */var gfDistribution=Ext.create('Ext.grid.feature.Grouping',{	groupHeaderTpl:'{name}'/*,	startCollapsed:true*/});var gDistribution=Ext.create('Ext.grid.Panel',{	store:sDistribution,	columnLines:true,	selType:'cellmodel',	features: 	[		gfDistribution	],	plugins: 	[		Ext.create('Ext.grid.plugin.CellEditing', 		{			clicksToEdit:1		})	],	columns:	[		{text:'Предмет',dataIndex:'SUBJECT_NAME',flex:3},		{text:'Доля вопросов в тесте',dataIndex:'QUESTION_PART',editor:{xtype:'textfield'},flex:1}	],	height:window.innerHeight/3,	width:window.innerWidth/1.5,	margin:10});/*-вопросы-*/var gQuestion=Ext.create('Ext.grid.Panel',{	store:sQuestion,	columnLines:true,	autoScroll:true,	selType:'cellmodel',	hidden:true,	/*feature:	[		{			ftype:'rowwrap'		}	],*/	listeners:	{		select:function(sm,selectedRecord)		{			Ext.getCmp('bQuestion').setDisabled(false);			Ext.getCmp('bAnswer').setDisabled(false);			if(wAnswer.isVisible())			{				var qid=selectedRecord.data['QUESTION_ID'];				//console.log(qid);				gAnswer.store.load({params:{QUESTION_ID:qid}});				Ext.getCmp('bdAnswer').setDisabled(true);			}		}	},	plugins: 	[		Ext.create('Ext.grid.plugin.CellEditing', 		{			clicksToEdit:2		})	],	columns:	[		{			xtype:'rownumberer',			text:'№',			width:30		},		{			text:'Текст',			dataIndex:'QUESTION_TEXT',			editor:			{				xtype:'textarea'			},			renderer:function(val,meta)			{				meta.style="font-weight:bold;";				return "<p style='height:20px;padding-left:5px;word-wrap:break-word;'>"+val+"</p>";			},			flex:2		},		{			text:'Описание',			dataIndex:'QUESTION_DESCR',			editor:			{				xtype:'textarea'			},			renderer:function(val,meta)			{				meta.style="font-weight:bold;";				if(val==null)					val=' ';				return Ext.String.format("<p style='height:20px;padding-left:5px;'>{0}</p>",val);			},			flex:1		}	],	height:window.innerHeight/1.5,	width:window.innerWidth/1.5,	margin:10,	rbar:	[		{			xtype:'button',			tooltip:'Добавить вопрос',			scale:'large',			icon:'img/add.ico',			handler:function(btn)			{				Ext.Ajax.request(				{					url:'php/question/get_seq.php',					success:function(response)					{						var editor=gQuestion.getPlugin();						editor.cancelEdit();						gQuestion.store.insert(0,{QUESTION_ID:response.responseText,QUESTION_TEXT:'',QUESTION_DESCR:'',SUBJECT_ID:cSubject.getValue()});						var task=new Ext.util.DelayedTask(function()						{							editor.startEditByPosition({								row:0,								column:1							});						});						task.delay(500);					}				});			}		},		{			xtype:'button',			tooltip:'Добавить ответы',			scale:'large',			id:'bAnswer',			disabled:true,			icon:'img/answer.ico',			handler:function(btn)			{				var qid=gQuestion.getView().getSelectionModel().getSelection()[0]				gAnswer.store.load({params:{QUESTION_ID:qid.data['QUESTION_ID']}});				wAnswer.show();				Ext.getCmp('bdAnswer').setDisabled(true);			}		},		{			xtype:'button',			tooltip:'Удалить вопрос',			scale:'large',			icon:'img/cut.ico',			id:'bQuestion',			disabled:true,			handler:function(btn)			{				var editor=gQuestion.getPlugin();				editor.cancelEdit();				Ext.Msg.show(				{					title:'Удалить',					msg:'Вы уверены?',					buttons:Ext.Msg.YESNO,					icon:Ext.Msg.QUESTION,					fn:delete_question				});				function delete_question(buttonId)				{					var rows=gQuestion.getView().getSelectionModel().getSelection()[0];					if(rows)					{						gQuestion.store.remove(rows);						btn.setDisabled(true);					}					else						Ext.Msg.alert('Предупреждение','Произошла ошибка!Попробуйте снова.');				}			}		}	]});/* ответы-*/var gAnswer=Ext.create('Ext.grid.Panel',{	store:sAnswer,	autoDestroy:false,	columnLines:true,	autoScroll:true,	selType:'cellmodel',	listeners:	{		select:function(sm,selectedRecord)		{			Ext.getCmp('bdAnswer').setDisabled(false);		}	},	plugins: 	[		Ext.create('Ext.grid.plugin.CellEditing', 		{			clicksToEdit:1		})	],	columns:	[		{xtype:'rownumberer',text:'№',width:30},		{			text:'Текст',			dataIndex:'ANSWER_TEXT',			editor:			{				xtype:'textfield'			},			flex:2		},		{			text:'Верно?',			dataIndex:'ANSWER_RIGHT',			editor:			{				xtype:'combobox',				store:scAnswer,				displayField:'data',				editable:false,				allowBlank:false,				lazyRender:true,				listClass:'x-combo-list-small'			},			flex:1		}	],	tbar:	[		{			xtype:'button',			tooltip:'Добавить ответ',			icon:'img/addd.ico',			handler:function(btn)			{				Ext.Ajax.request(				{					url:'php/answer/get_seq.php',					success:function(response)					{						var editor=gAnswer.getPlugin();						editor.cancelEdit();						var row=gQuestion.getView().getSelectionModel().getSelection()[0];						gAnswer.store.insert(0,{ANSWER_ID:response.responseText,ANSWER_TEXT:'',ANSWER_RIGHT:'нет',QUESTION_ID:row.data['QUESTION_ID']});						var task=new Ext.util.DelayedTask(function()						{							editor.startEditByPosition({								row:0,								column:1							});						});						task.delay(500);					}				});			}		},		{			xtype:'button',			tooltip:'Удалить ответ',			icon:'img/cutt.ico',			id:'bdAnswer',			disabled:true,			handler:function(btn)			{				var editor=gAnswer.getPlugin();				editor.cancelEdit();				Ext.Msg.show(				{					title:'Удалить',					msg:'Вы уверены?',					buttons:Ext.Msg.YESNO,					icon:Ext.Msg.QUESTION,					fn:delete_answer				});				function delete_answer(buttonId)				{					var rows=gAnswer.getView().getSelectionModel().getSelection()[0];					if(rows)					{						gAnswer.store.remove(rows);						btn.setDisabled(true);					}					else						Ext.Msg.alert('Предупреждение','Произошла ошибка!Попробуйте снова.');				}			}		}	]});var wAnswer=Ext.create('Ext.window.Window',{	title:'Ответы',	autoDestroy:false,	closeAction:'hide', 	height:350,	width:450,	resizable:false,	items: 	[		gAnswer	]});